<launch>
    <node name="camera" pkg="usb_cam" type="usb_cam_node" respawn="true">
          <param name="video_device" value="/dev/video0"/>
          <param name="camera_info_url" value="file:///home/swarmie/SwarmieOS/src/mobility/camera_info/head_camera.yaml"/>
          <param name="camera_name" value="head_camera"/>
          <param name="image_width" value="320"/>
          <param name="image_height" value="240"/>
          <param name="framerate" value="10"/>
          <param name="pixel_format" value="yuyv"/>
          <param name="camera_frame_id" value="r9/camera_link"/>
        </node>
        
    <node pkg="apriltag_ros" type="apriltag_ros_continuous_node" name="apriltag" clear_params="true" respawn="true">
        <param name="camera_frame" value="r9/camera_link" />
        <param name="publish_tag_detections_image" value="true" />
        <param name="tag_family" value="tag36h11" />
        <param name="tag_threads" value="2" />
        <param name="tag_decimate" value="1.0" />
        <param name="tag_blur" value="0.0" />
        <param name="tag_refine_edges" value="1" />
        <param name="tag_debug" value="0" />
        <param name="publish_tf" value="true" />
        <param name="remove_duplicates" value="false" />
        <remap from="image_rect" to="camera/image_raw" />
        <remap from="tag_detections_image" to="targets/image" />
        <remap from="tag_detections" to="targets" />
        <rosparam param="standalone_tags">
          [
            {id: 0, size: 0.04},
            {id: 1, size: 0.038},
            {id: 256, size: 0.038}
          ]
        </rosparam>
    </node>
    
    <node name="abridge" pkg="bridge" type="abridge" respawn="true"> 
      <param name="device" value="/dev/ttyACM0"/>
      <param name="scale" value="0.1" />
      <param name="Kp" value="0.0075" />
      <param name="Ki" value="0.15" />
      <param name="Kd" value="0.002" />
      <param name="db" value="0.0" />
      <param name="st" value="0.0" />
      <param name="wu" value="3.0" />
      <param name="ff_l" value="0.0095" />
      <param name="ff_r" value="0.012" />
    </node>
    
    <node name="stfBase2Cam" pkg="tf2_ros" type="static_transform_publisher"
          args="0.12 0.0 0.195 -1.570796 0 -2.09 base_link r9/camera_link" respawn="true">
    </node>

    <node name="stfBase2SL" pkg="tf2_ros" type="static_transform_publisher"
        args="0.11 0.05 0.155 0.43633 0 0 base_link us_left_link"
        respawn="true" />
        
    <node name="stfBase2SC" pkg="tf2_ros" type="static_transform_publisher"
        args="0.12 0 0.155 0 0 0 base_link us_center_link"
        respawn="true" />
        
    <node name="stfBase2SR" pkg="tf2_ros" type="static_transform_publisher"
        args="0.11 -0.05 0.155 -0.43633 0 0 base_link us_right_link"
        respawn="true" />
    
    <node name="ekfOdom" pkg="robot_localization" type="ekf_localization_node" respawn="false">
    
    <param name="odom_frame" value="/odom" />
    <param name="world_frame" value="/odom" />
    <param name="base_link_frame" value="/base_link"/>
    
    <param name="odom0" value="odom" />
    <param name="imu0" value="imu" />
    <param name="two_d_mode" value="true" />
    <param name="frequency" value="10" />
  
    <param name="print_diagnostics" value="false"/>

    <rosparam param="odom0_config">[false, false, false,
                                    false, false, false,
                                    true, true, false,
                                    false, false, true,
                                    false, false, false]</rosparam>

    <rosparam param="imu0_config">[false, false, false, 
                                   false, false, true,
                                   false, false, false,
                                   false, false, true,
                                   false, false, false]</rosparam>

    <rosparam param="initial_estimate_covariance">
      [1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1e-9, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1e-9, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1e-9, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1e-9]
    </rosparam>

    <rosparam param="process_noise_covariance">
      [7e-4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 7e-4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0.06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0.03, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0.03, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 1e-5, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0.025, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0.025, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0.04, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0,
       0, 0, 0, 0, 0, 0, 0,  0,  0, 0, 0, 0, 0, 0, 0.015]
    </rosparam>

    <remap from="odometry/filtered" to="odom/filtered" />
    
  </node>
  
  
  <node pkg="ublox_gps" type="ublox_gps" name="ublox_gps_test"
        respawn="true"
        respawn_delay="1"
        clear_params="true">
        <rosparam>
        frame_id: "r9/base_link"
        fix_mode: "2d"
        </rosparam>
  </node>
</launch>
